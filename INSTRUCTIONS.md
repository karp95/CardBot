# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ CardBot

## –ë–æ—Ç: @VitaCardsBot

–¢–æ–∫–µ–Ω –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ `.env`. –§–∞–π–ª `.env` –≤ `.gitignore` ‚Äî –Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è.

‚ö†Ô∏è **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –±—ã–ª –ø–æ–∫–∞–∑–∞–Ω –≤ —á–∞—Ç–µ –∏–ª–∏ –≥–¥–µ-—Ç–æ –µ—â—ë ‚Äî –∑–∞–π–¥–∏ –≤ @BotFather ‚Üí `/mybots` ‚Üí –≤—ã–±–µ—Ä–∏ –±–æ—Ç–∞ ‚Üí `API Token` ‚Üí `Revoke current token` –∏ —Å–æ–∑–¥–∞–π –Ω–æ–≤—ã–π. –°—Ç–∞—Ä—ã–π —Ç–æ–∫–µ–Ω –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ø–µ—Ä–µ—Å—Ç–∞–Ω–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å.

---

## –ó–∞–¥–∞—á–∞ 1.1‚Äì1.6: –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–≤—ã–ø–æ–ª–Ω–µ–Ω–æ)

### –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ
- Spring Boot –ø—Ä–æ–µ–∫—Ç (Maven)
- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: JPA, Web, PostgreSQL, Telegram Bots, Flyway, Lombok
- application.yml —Å —á—Ç–µ–Ω–∏–µ–º –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- .env.example, .gitignore
- –¢–µ—Å—Ç `CardBotApplicationTests` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

**1. –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤:**
```bash
cd /Users/dmitrijkarpov/Desktop/KarpProjectJava/CardBot
mvn test
```
–û–∂–∏–¥–∞–µ—Ç—Å—è: `BUILD SUCCESS`, —Ç–µ—Å—Ç `contextLoads` –ø—Ä–æ—Ö–æ–¥–∏—Ç.

**2. –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞:**
```bash
mvn clean compile
```
–û–∂–∏–¥–∞–µ—Ç—Å—è: `BUILD SUCCESS`.

### –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≤—Ä—É—á–Ω—É—é (–ø–µ—Ä–µ–¥ –ø–æ–ª–Ω—ã–º –∑–∞–ø—É—Å–∫–æ–º –±–æ—Ç–∞)

1. **–°–æ–∑–¥–∞—Ç—å –±–æ—Ç–∞ –≤ Telegram:**
   - –û—Ç–∫—Ä—ã—Ç—å [@BotFather](https://t.me/BotFather)
   - –û—Ç–ø—Ä–∞–≤–∏—Ç—å `/newbot`
   - –í–≤–µ—Å—Ç–∏ –∏–º—è –∏ username –±–æ—Ç–∞
   - –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–∫–µ–Ω

2. **PostgreSQL** (—É–∂–µ –ø–æ–¥–Ω—è—Ç ‚úì):
   - **–°–æ–∑–¥–∞—Ç—å –ë–î cardbot** (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):
     ```bash
     # –í–∞—Ä–∏–∞–Ω—Ç 1: –µ—Å–ª–∏ psql –≤ PATH
     psql -U postgres -c "CREATE DATABASE cardbot;"
     
     # –í–∞—Ä–∏–∞–Ω—Ç 2: —á–µ—Ä–µ–∑ createdb
     createdb -U postgres cardbot
     
     # –í–∞—Ä–∏–∞–Ω—Ç 3: Postgres.app ‚Äî –æ—Ç–∫—Ä—ã—Ç—å psql –∏–∑ –º–µ–Ω—é –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å:
     CREATE DATABASE cardbot;
     ```
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤ `.env` —É–∫–∞–∑–∞–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ DB_URL, DB_USERNAME, DB_PASSWORD

3. **–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª .env** (—Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏–∑ .env.example):
   ```bash
   cp .env.example .env
   ```
   –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è: `BOT_TOKEN`, `DB_PASSWORD` –∏ —Ç.–¥.

4. **–ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è** (–ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á 2.x ‚Äî –º–∏–≥—Ä–∞—Ü–∏–∏):
   ```bash
   export $(cat .env | xargs)  # –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ .env
   mvn spring-boot:run
   ```

---

## –ó–∞–¥–∞—á–∞ 2.4‚Äì2.9: –ú–æ–¥–µ–ª–∏ –∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ (–≤—ã–ø–æ–ª–Ω–µ–Ω–æ)

### –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ
- **User** ‚Äî telegramId, username, createdAt
- **Card** ‚Äî word, translation, transcription, user
- **LearningStats** ‚Äî cardsViewedTotal, lastReminderAt, user
- **UserRepository** ‚Äî findByTelegramId
- **CardRepository** ‚Äî findByUserId, countByUserId, findRandomByUserId
- **LearningStatsRepository** ‚Äî findByUserId
- –¢–µ—Å—Ç—ã: UserRepositoryTest, CardRepositoryTest, LearningStatsRepositoryTest

### –ü—Ä–æ–≤–µ—Ä–∫–∞
```bash
mvn test
```
–û–∂–∏–¥–∞–µ—Ç—Å—è: 7 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç (1 contextLoads + 6 repository tests).

---

## –ó–∞–¥–∞—á–∞ 3.1‚Äì3.6: –°–µ—Ä–≤–∏—Å—ã (–≤—ã–ø–æ–ª–Ω–µ–Ω–æ)

### –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ
- **UserService** ‚Äî getOrCreate(telegramId, username)
- **CardService** ‚Äî create, createFromInput (–ø–∞—Ä—Å–∏–Ω–≥ —á–µ—Ä–µ–∑ +), update, delete, findAllByUser, getRandomCard
- **LearningService** ‚Äî getNextCard, incrementCardsViewed
- **StatsService** ‚Äî getStats (totalCards, cardsViewedTotal)
- –¢–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

### –ü—Ä–æ–≤–µ—Ä–∫–∞
```bash
mvn test
```

---

---

## –ó–∞–¥–∞—á–∞ 4.1‚Äì4.8: Telegram Bot ‚Äî MVP (–≤—ã–ø–æ–ª–Ω–µ–Ω–æ)

### –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ
- **CardTelegramBot** ‚Äî extends TelegramLongPollingBot
- **–ö–æ–º–∞–Ω–¥—ã**: /start, /add, /learn, /stats, /list, /help
- **Inline-–∫–Ω–æ–ø–∫–∏**: –ü–æ–∫–∞–∑–∞—Ç—å –ø–µ—Ä–µ–≤–æ–¥, –°–ª–µ–¥—É—é—â–∞—è, –ó–∞–∫–æ–Ω—á–∏—Ç—å
- **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è** –±–æ—Ç–∞ –≤ main() —á–µ—Ä–µ–∑ TelegramBotsApi

### –ü—Ä–æ–≤–µ—Ä–∫–∞
```bash
export $(grep -v '^#' .env | xargs)
mvn spring-boot:run
```
–ó–∞—Ç–µ–º –≤ Telegram: @VitaCardsBot ‚Üí /start, /add apple + —è–±–ª–æ–∫–æ, /learn

---

## –ó–∞–¥–∞—á–∞ 5.1‚Äì5.4: –°–ø–∏—Å–æ–∫, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ (–≤—ã–ø–æ–ª–Ω–µ–Ω–æ)

### –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ
- **/list** ‚Äî –ø–∞–≥–∏–Ω–∞—Ü–∏—è (5 –∫–∞—Ä—Ç–æ—á–µ–∫ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É), –∫–Ω–æ–ø–∫–∏ ‚óÄ –ù–∞–∑–∞–¥ / –í–ø–µ—Ä—ë–¥ ‚ñ∂
- **–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî –∫–Ω–æ–ø–∫–∞ ‚úèÔ∏è ‚Üí –≤–≤–æ–¥ –Ω–æ–≤–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è (—Å–ª–æ–≤–æ + –ø–µ—Ä–µ–≤–æ–¥ + —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è)
- **–£–¥–∞–ª–µ–Ω–∏–µ** ‚Äî –∫–Ω–æ–ø–∫–∞ üóë ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ ¬´–î–∞, —É–¥–∞–ª–∏—Ç—å¬ª / ¬´–ù–µ—Ç¬ª
- **UserState** ‚Äî —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (ConcurrentHashMap)
- **/cancel** ‚Äî –æ—Ç–º–µ–Ω–∞ —Ç–µ–∫—É—â–µ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è

---

## –ó–∞–¥–∞—á–∞ 7.1‚Äì7.3: –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è (–≤—ã–ø–æ–ª–Ω–µ–Ω–æ)

### –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ
- **ReminderService** ‚Äî @Scheduled(cron = "0 0 10 * * ?") ‚Äî –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 10:00 UTC
- **–õ–æ–≥–∏–∫–∞**: –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Å –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —É—á–∏–ª–∏—Å—å —Å–µ–≥–æ–¥–Ω—è
- **last_learned_at** ‚Äî –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ –∫–∞—Ä—Ç–æ—á–∫–∏
- **–ö–Ω–æ–ø–∫–∞ ¬´–£—á–∏—Ç—å¬ª** ‚Äî –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø–µ—Ä–≤—É—é –∫–∞—Ä—Ç–æ—á–∫—É

### –í—Ä–µ–º—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
–°–µ–π—á–∞—Å: **10:00 UTC**. –ß—Ç–æ–±—ã –∏–∑–º–µ–Ω–∏—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, 10:00 –ú–°–ö = 07:00 UTC), –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π cron –≤ `ReminderService.java`.

---

## –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker Compose

PostgreSQL –∏ –±–æ—Ç –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö. **–î–∞–Ω–Ω—ã–µ –ë–î —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è** –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–º–∏ (volume `postgres_data`).

**1. –°–æ–∑–¥–∞—Ç—å `.env`** (–µ—Å–ª–∏ –µ—â—ë –Ω–µ—Ç):
```bash
cp .env.example .env
# –ó–∞–ø–æ–ª–Ω–∏—Ç—å BOT_TOKEN
```

**2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å—ë:**
```bash
docker compose up -d
```

**3. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å:**
```bash
docker compose down
```
–î–∞–Ω–Ω—ã–µ –ë–î –æ—Å—Ç–∞—é—Ç—Å—è –≤ volume. –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º `docker compose up -d` –æ–Ω–∏ –ø–æ–¥—Ö–≤–∞—Ç—è—Ç—Å—è.

**4. –¢–æ–ª—å–∫–æ PostgreSQL** (–±–æ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ —á–µ—Ä–µ–∑ `mvn spring-boot:run`):
```bash
docker compose up -d postgres
```

---

## –ë–æ—Ç –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

–í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã.

**–†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:** —Å–º. **[DEPLOYMENT.md](DEPLOYMENT.md)** ‚Äî –ø–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è.

---

## –ü–ª–∞–Ω —É–ª—É—á—à–µ–Ω–∏–π

–°–º. **[IMPROVEMENT_PLAN.md](IMPROVEMENT_PLAN.md)** ‚Äî —Ä–∞–∑–±–∏–≤–∫–∞ –Ω–∞ –∑–∞–¥–∞—á–∏ –ø–æ —Ñ–∞–∑–∞–º (–±—ã—Å—Ç—Ä—ã–µ —É–ª—É—á—à–µ–Ω–∏—è, –Ω–æ–≤—ã–µ —Ä–µ–∂–∏–º—ã, UX, —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ, –∫–æ–Ω—Ç–µ–Ω—Ç).
